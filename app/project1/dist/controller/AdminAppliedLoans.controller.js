sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/odata/v2/ODataModel"],function(e,t,o,a,n){"use strict";return e.extend("project1.controller.AdminAppliedLoans",{onViewDetails:function(e){sap.ui.core.BusyIndicator.show(0);var t=e.getSource().getBindingContext("mainModel");var o=this.byId("customerDetailsDialog");o.setBindingContext(t,"mainModel");o.open(sap.ui.core.BusyIndicator.hide())},onCloseDialog:function(){this.byId("customerDetailsDialog").close()},onApproveLoan:function(){sap.ui.core.BusyIndicator.show(0);var e=this.byId("customerDetailsDialog");var o=e.getBindingContext("mainModel");var a=this.getView().getModel("mainModel");var n=o.getObject();a.callFunction("/approveLoan",{method:"POST",urlParameters:{Id:n.Id},success:function(){sap.ui.core.BusyIndicator.hide();a.refresh();t.show("Loan Approved");e.close()},error:function(){sap.ui.core.BusyIndicator.hide();t.show("Error Approving Loan")}})},onRejectLoan:function(){sap.ui.core.BusyIndicator.show(0);var e=this.byId("customerDetailsDialog");var o=e.getBindingContext("mainModel");var a=this.getView().getModel("mainModel");var n=o.getObject();a.callFunction("/rejectLoan",{method:"POST",urlParameters:{Id:n.Id},success:function(){sap.ui.core.BusyIndicator.hide();a.refresh();t.show("Loan Rejected");e.close()},error:function(){sap.ui.core.BusyIndicator.hide();t.show("Error Rejecting Loan")}})},onLogout:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("RouteView1");t.show("Logged out!")},onHome:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("dashboard");t.show("Returned Home")},onSearch:function(e){var t=e.getSource().getValue();var n=[new o("applicantName",a.Contains,t),new o("applicantEmail",a.Contains,t),new o("applicantPHno",a.Contains,t),new o("applicantAadhar",a.Contains,t)];var s=new o({filters:n,and:false});var r=this.byId("loanList");var i=r.getBinding("rows");i.filter(s)},onReset:function(){var e=this.byId("loanList");var t=e.getBinding("rows");t.filter([]);t.sort([]);this.getView().byId("querySearch").setValue("");this.getView().byId("statusComboBox").setValue("All");this.getView().byId("GroupBy").setValue("")},onSort:function(){var e=this.byId("loanList");var t=e.getBinding("rows");this._bSortAscending=!this._bSortAscending;var o=new sap.ui.model.Sorter("applicantName",!this._bSortAscending);t.sort(o)},onGroup:function(){var e=this.byId("loanList");var t=e.getBinding("rows");var o=new sap.ui.model.Sorter("loanStatus",false,function(e){var t=e.getProperty("loanStatus");return{key:t,text:"LOAN STATUS : "+t}});t.sort(o)},onDefaultActionAccept:function(){sap.m.MessageToast.show("Default export action triggered.")},onBeforeMenuOpen:function(e){console.log("Menu is about to open.")},onExportAsPDF:async function(){try{const e=window.jspdf||window.jspdf?.default;if(!e||!e.jsPDF){sap.m.MessageToast.show("jsPDF library not loaded.");return}const{jsPDF:t}=e;const o=this.getView().getModel("mainModel");o.read("/customer",{success:function(e){const o=e.results;if(!o.length){sap.m.MessageToast.show("No customer data found.");return}const a=new t;a.setFontSize(14);a.text("Customer Loan Details",20,20);let n=30;let s=1;o.forEach(e=>{a.setFontSize(12);a.text(`CUSTOMER ${s++}`,20,n);n+=10;a.setFontSize(10);a.text("ID: "+e.Id,20,n);a.text("Name: "+e.applicantName,20,n+=10);a.text("Email: "+e.applicantEmail,20,n+=10);a.text("Mobile: "+e.applicantPHno,20,n+=10);a.text("Aadhar No.: "+e.applicantAadhar,20,n+=10);a.text("PAN No.: "+e.applicantPAN,20,n+=10);a.text("Salary: "+e.applicantSalary,20,n+=10);a.text("Tenure: "+e.loanRepaymentMonths+" Months",20,n+=10);a.text("Principal: "+e.loanAmount,20,n+=10);a.text("Loan Status: "+e.loanStatus,20,n+=10);a.text("Address: "+e.applicantAddress,20,n+=10);n+=20;if(n>270){a.addPage();n=20}});a.save("AllCustomerLoanDetails.pdf")},error:function(e){console.error("Error fetching customer data:",e);sap.m.MessageToast.show("Failed to export customer data.")}})}catch(e){console.error("Unexpected error:",e);sap.m.MessageToast.show("Failed to export customer data.")}},onExportToExcel:function(){try{const e=this.getView().getModel("mainModel");e.read("/customer",{success:function(e){const t=e.results;if(!t.length){sap.m.MessageToast.show("No customer data found.");return}const o=[["ID","Name","Email","Mobile","Aadhar No.","PAN No.","Salary","Tenure","Principal","Loan Status","Address"]];t.forEach(e=>{o.push([e.Id,e.applicantName,e.applicantEmail,e.applicantPHno,e.applicantAadhar,e.applicantPAN,e.applicantSalary,e.loanRepaymentMonths,e.loanAmount,e.loanStatus,e.applicantAddress])});const a=XLSX.utils.aoa_to_sheet(o);const n=XLSX.utils.book_new();XLSX.utils.book_append_sheet(n,a,"Loan Details");XLSX.writeFile(n,"CustomerLoanDetails.xlsx")},error:function(e){console.error("Error exporting Excel:",e);sap.m.MessageToast.show("Failed to export Excel file.")}})}catch(e){console.error("Unexpected error:",e);sap.m.MessageToast.show("Failed to export Excel file.")}},onMenuAction:function(e){var t=e.getParameter("item");if(!t)return;var o=t.getText();switch(o){case"Export as PDF":this.onExportAsPDF();break;case"Export to Excel":this.onExportToExcel();break;default:sap.m.MessageToast.show("Unknown export option selected.")}},onAfterRendering:function(){var e=this.byId("statusComboBox");e.setSelectedKey("Pending");this.onStatusChange({getSource:()=>e})},onStatusChange:function(e){var t=e.getSource().getSelectedKey();var o=this.byId("loanList");var a=o.getBinding("rows");var n=[];if(t!=="All"){n.push(new sap.ui.model.Filter("loanStatus",sap.ui.model.FilterOperator.EQ,t))}if(a){a.filter(n)}else{console.warn("Table binding not ready yet.")}},isPending:function(e){return e==="Pending"}})});
//# sourceMappingURL=AdminAppliedLoans.controller.js.map
sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/json/JSONModel"],(e,a,t,r)=>{"use strict";return e.extend("project1.controller.loanApplication",{onAfterRendering:function(){const e=["enterApplicantName","enterApplicantAddress","enterApplicantMobileNo","enterEmailId","enterAadhaarNo","enterPanNo","enterSalary","enterloanamount","enterloanrepaymentmonths"];e.forEach((a,t)=>{const r=this.byId(a);if(r){r.attachBrowserEvent("keydown",a=>{if(a.key==="Enter"){a.preventDefault();const r=e[t+1];if(r){const e=this.byId(r);if(e){e.focus()}}}})}})},onSubmit(){sap.ui.core.BusyIndicator.show(0);var e=this.getView().byId("enterApplicantName").getValue();var r=this.getView().byId("enterApplicantAddress").getValue();var s=this.getView().byId("enterApplicantMobileNo").getValue();var o=this.getView().byId("enterEmailId").getValue();var n=this.getView().byId("enterAadhaarNo").getValue();var l=this.getView().byId("enterPanNo").getValue();var i=this.getView().byId("enterSalary").getValue();var u=this.getView().byId("enterloanamount").getValue();var c=this.getView().byId("enterloanrepaymentmonths").getValue();var p=/^[a-zA-Z\s]+$/;var d=/^[0-9]{10}$/;var h=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;var m=/^[0-9]{12}$/;var V=/[A-Z]{5}[0-9]{4}[A-Z]{1}$/;var g=/^[0-9]*$/;var f=/^[0-9]*$/;var S=/^[0-9]{1,2}$/;let v=[];if(!e.match(p))v.push("Applicant name (only alphabets are allowed)");if(!s.match(d))v.push("Applicant Mobile No (Must be 10 digits");if(!o.match(h))v.push("Applicant Email Id (Invalid email format)");if(!n.match(m))v.push("Applicant Aadhaar No (Must be 12 digits)");if(!l.match(V))v.push("Applicant PAN No (Invalid Pan No format)");if(!i.match(g))v.push("Applicant Salary (only numbers allowed)");if(!u.match(f))v.push("Applicant LoanAmount (only Numbers are allowed)");if(!c.match(S))v.push("Applicant Repaymonths (upto 2 digits)");if(v.length>0){sap.m.MessageBox.error("Please correct the following fields:\n"+v.join("\n"),{onClose:()=>{sap.ui.core.BusyIndicator.hide(0)}});return}let y=[];if(!e)y.push("Applicant Name");if(!r)y.push("Applicant Address");if(!s)y.push("Applicant Moblie No");if(!n)y.push("Applicant Aadhaar No");if(!o)y.push("Applicant Email Id");if(!l)y.push("PAN No");if(!i)y.push("Applicant Salary");if(!u)y.push("Loan Amount");if(!c)y.push("Loan Repayment Months");if(y.length>0){sap.m.MessageBox.error("Please fill the required fields:\n"+y.join("\n"),{onClose:()=>{sap.ui.core.BusyIndicator.hide(0)}});return}var b={applicantName:e,applicantAddress:r,applicantPHno:s,applicantEmail:o,applicantAadhar:n,applicantPAN:l,applicantSalary:i,loanAmount:u,loanRepaymentMonths:c,documentUrl:this.documentUrl};var A=this.getView().getModel("mainModel");A.callFunction("/submitLoanApplication",{method:"POST",urlParameters:b,success:e=>{sap.ui.core.BusyIndicator.hide(0);a.success("You have applied for loan successfully\nYour loan id:"+e.submitLoanApplication.Id,{onClose:()=>{this.byId("enterApplicantName").setValue("");this.byId("enterApplicantAddress").setValue("");this.byId("enterApplicantMobileNo").setValue("");this.byId("enterEmailId").setValue("");this.byId("enterAadhaarNo").setValue("");this.byId("enterPanNo").setValue("");this.byId("enterSalary").setValue("");this.byId("enterloanamount").setValue("");this.byId("enterloanrepaymentmonths").setValue("");var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("dashboard")}})},error:e=>{t.show("Error submitting: "+e.responseText)}})},onCancel(){sap.m.MessageToast.show("Loan application cancelled")},onChooseFile:function(){var e=document.createElement("input");e.type="file";e.onchange=function(e){var a=e.target.files[0];this._file=a;var t=this.byId("filePath");t.setValue(a.name)}.bind(this);e.click()},onUpload:function(){var e=this._file;if(!e){sap.m.MessageToast.show("Please choose a file first.");return}var a=e.name;var t=e.size;var r=a.substr(a.lastIndexOf(".")+1).toLowerCase();if(!["pdf","jpeg","png","jpg"].includes(r)){sap.m.MessageToast.show("Kindly upload only JPG, JPEG, PDF, and PNG files");return}else if(t>2e6){sap.m.MessageToast.show("File size should not be more than 2MB.");return}var s=new FileReader;s.onload=function(a){var t=new Uint8Array(a.target.result);var r=pako.deflate(t);var s=Array.from(r,e=>String.fromCharCode(e)).join("");var o=btoa(s);this.filebase64String=o;var n=this.getView().getModel("mainModel");if(!n){sap.m.MessageBox.error("OData model 'mainModel' not found.");return}n.callFunction("/uploadDocument",{method:"POST",urlParameters:{fileName:e.name,fileContent:this.filebase64String},success:function(e){this.documentUrl=e.fileUrl;sap.m.MessageToast.show("File uploaded successfully.")}.bind(this),error:function(e){console.error("Upload failed",e);sap.m.MessageBox.error("File upload failed. Please try again.")}})}.bind(this);s.readAsArrayBuffer(e)},onClear:function(){this.byId("enterApplicantName").setValue("");this.byId("enterApplicantAddress").setValue("");this.byId("enterApplicantMobileNo").setValue("");this.byId("enterEmailId").setValue("");this.byId("enterAadhaarNo").setValue("");this.byId("enterPanNo").setValue("");this.byId("enterSalary").setValue("");this.byId("enterloanamount").setValue("");this.byId("enterloanrepaymentmonths").setValue("");this.byId("selectDocumentType").setSelectedKey(null)},nameValidation:function(e){var a=e.getSource().getValue();var t=e.getSource();var r=/^[a-zA-Z\s]+$/;var s=a.length;if(s==50){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("More Than 50 Characters Not Accepted")}else if(!a.match(r)){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Only Alphabets can Accepted")}else{t.setValueState(sap.ui.core.ValueState.None)}},numValidation:function(e){var a=e.getSource().getValue();var t=e.getSource();var r=/^[0-9]{10}$/;var s=a.length;if(s!==10){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Mobile number must be 10 digits")}else if(!a.match(r)){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Only Numbers can Accepted")}else{t.setValueState(sap.ui.core.ValueState.None)}},emailValidation:function(e){var a=["com","org","net","edu","gov","in","co","io","ai","info","biz","me"];var t=e.getSource().getValue().trim();var r=e.getSource();var s=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;var o=t.split(".");var n=o.length>1?o[o.length-1].toLowerCase():"";if(!s.test(t)||!a.includes(n)){r.setValueState(sap.ui.core.ValueState.Error);r.setValueStateText("Invalid email address")}else{r.setValueState(sap.ui.core.ValueState.None)}},aadhaarValidation:function(e){var a=e.getSource().getValue();var t=e.getSource();var r=/^[0-9]{12}$/;var s=a.length;if(s!==12){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Aadhaar number must be 12 digits")}else if(!a.match(r)){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Only Numbers can Accepted")}else{t.setValueState(sap.ui.core.ValueState.None)}},panValidation:function(e){var a=e.getSource().getValue().toUpperCase();e.getSource().setValue(a);var a=e.getSource().getValue();var t=e.getSource();var r=/[A-Z]{5}[0-9]{4}[A-Z]{1}$/;var s=a.length;if(s!==10){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Pan number must be 10 digits")}else if(!a.match(r)){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Invalid Pan number")}else{t.setValueState(sap.ui.core.ValueState.None)}},repayValidation:function(e){var a=e.getSource().getValue();var t=e.getSource();var r=/^[0-9]{1,2}$/;var s=a.length;if(s===0||s>2){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Repayment months allowed upto 2 digits")}else if(!a.match(r)){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Only Numbers can Accepted")}else{t.setValueState(sap.ui.core.ValueState.None)}},salaryValidation:function(e){var a=e.getSource().getValue();var t=e.getSource();var r=/^[0-9]*$/;var s=a.length;if(s===0){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Salary cannot be empty")}else if(!a.match(r)){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Only Numbers can Accepted")}else{t.setValueState(sap.ui.core.ValueState.None)}},loanamountValidation:function(e){var a=e.getSource().getValue();var t=e.getSource();var r=/^[0-9]*$/;var s=a.length;if(s===0){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Loan Amount cannot be empty")}else if(!a.match(r)){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Only Numbers can Accepted")}else{t.setValueState(sap.ui.core.ValueState.None)}},onLogout:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("RouteView1");t.show("Logged out!")},onHome:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("dashboard");t.show("Returned Home")}})});
//# sourceMappingURL=loanApplication.controller.js.map
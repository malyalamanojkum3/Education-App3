sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/json/JSONModel"],(e,t,a,r)=>{"use strict";return e.extend("project1.controller.loanApplication",{onAfterRendering:function(){const e=["enterApplicantName","enterApplicantAddress","enterApplicantMobileNo","enterEmailId","enterAadhaarNo","enterPanNo","enterSalary","enterloanamount","enterloanrepaymentmonths"];e.forEach((t,a)=>{const r=this.byId(t);if(r){r.attachBrowserEvent("keydown",t=>{if(t.key==="Enter"){t.preventDefault();const r=e[a+1];if(r){const e=this.byId(r);if(e){e.focus()}}}})}})},onSubmit(){sap.ui.core.BusyIndicator.show(0);var e=this.getView().byId("enterApplicantName").getValue();var r=this.getView().byId("enterApplicantAddress").getValue();var s=this.getView().byId("enterApplicantMobileNo").getValue();var o=this.getView().byId("enterEmailId").getValue();var n=this.getView().byId("enterAadhaarNo").getValue();var l=this.getView().byId("enterPanNo").getValue();var i=this.getView().byId("enterSalary").getValue();var u=this.getView().byId("enterloanamount").getValue();var c=this.getView().byId("enterloanrepaymentmonths").getValue();var p=/^[a-zA-Z\s]+$/;var d=/^[0-9]{10}$/;var h=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;var m=/^[0-9]{12}$/;var V=/[A-Z]{5}[0-9]{4}[A-Z]{1}$/;var g=/^[0-9]*$/;var f=/^[0-9]*$/;var S=/^[0-9]{1,2}$/;let v=[];if(!e.match(p))v.push("Applicant name (only alphabets are allowed)");if(!s.match(d))v.push("Applicant Mobile No (Must be 10 digits");if(!o.match(h))v.push("Applicant Email Id (Invalid email format)");if(!n.match(m))v.push("Applicant Aadhaar No (Must be 12 digits)");if(!l.match(V))v.push("Applicant PAN No (Invalid Pan No format)");if(!i.match(g))v.push("Applicant Salary (only numbers allowed)");if(!u.match(f))v.push("Applicant LoanAmount (only Numbers are allowed)");if(!c.match(S))v.push("Applicant Repaymonths (upto 2 digits)");if(v.length>0){sap.m.MessageBox.error("Please correct the following fields:\n"+v.join("\n"),{onClose:()=>{sap.ui.core.BusyIndicator.hide(0)}});return}let y=[];if(!e)y.push("Applicant Name");if(!r)y.push("Applicant Address");if(!s)y.push("Applicant Moblie No");if(!n)y.push("Applicant Aadhaar No");if(!o)y.push("Applicant Email Id");if(!l)y.push("PAN No");if(!i)y.push("Applicant Salary");if(!u)y.push("Loan Amount");if(!c)y.push("Loan Repayment Months");if(y.length>0){sap.m.MessageBox.error("Please fill the required fields:\n"+y.join("\n"),{onClose:()=>{sap.ui.core.BusyIndicator.hide(0)}});return}console.log("ðŸ“¦ Document URL before submit:",this.documentUrl);if(!this.documentUrl){sap.m.MessageBox.error("Please upload a document before submitting.");sap.ui.core.BusyIndicator.hide(0);return}var b={applicantName:e,applicantAddress:r,applicantPHno:s,applicantEmail:o,applicantAadhar:n,applicantPAN:l,applicantSalary:i,loanAmount:u,loanRepaymentMonths:c,document:this.documentUrl};var A=this.getView().getModel("mainModel");A.callFunction("/submitLoanApplication",{method:"POST",urlParameters:b,success:e=>{sap.ui.core.BusyIndicator.hide(0);console.log("âœ… Submission success response:",e);t.success("You have applied for loan successfully\nYour loan id:"+e.submitLoanApplication.Id,{onClose:()=>{this.byId("enterApplicantName").setValue("");this.byId("enterApplicantAddress").setValue("");this.byId("enterApplicantMobileNo").setValue("");this.byId("enterEmailId").setValue("");this.byId("enterAadhaarNo").setValue("");this.byId("enterPanNo").setValue("");this.byId("enterSalary").setValue("");this.byId("enterloanamount").setValue("");this.byId("enterloanrepaymentmonths").setValue("");var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("dashboard")}})},error:e=>{a.show("Error submitting: "+e.responseText)}})},onCancel(){sap.m.MessageToast.show("Loan application cancelled")},onChooseFile:function(){var e=document.createElement("input");e.type="file";e.onchange=function(e){var t=e.target.files[0];this._file=t;var a=this.byId("filePath");a.setValue(t.name)}.bind(this);e.click()},onUpload:function(){var e=this._file;if(!e){sap.m.MessageToast.show("Please choose a file first.");return}var t=e.name;var a=e.size;var r=t.substr(t.lastIndexOf(".")+1).toLowerCase();if(!["pdf","jpeg","png","jpg"].includes(r)){sap.m.MessageToast.show("Kindly upload only JPG, JPEG, PDF, and PNG files");return}else if(a>2e6){sap.m.MessageToast.show("File size should not be more than 2MB.");return}var s=new FileReader;s.onload=function(t){var a="";var r=new Uint8Array(t.target.result);var s=r.byteLength;for(var o=0;o<s;o++){a+=String.fromCharCode(r[o])}var n=btoa(a);var l=this.getView().getModel("mainModel");l.callFunction("/uploadDocument",{method:"POST",urlParameters:{fileName:e.name,fileContent:n},success:function(e){this.documentUrl=e.uploadDocument;sap.m.MessageToast.show("File uploaded successfully.")}.bind(this),error:function(e){sap.m.MessageBox.error("File upload failed. Please try again.")}})}.bind(this);s.readAsArrayBuffer(e)},onClear:function(){this.byId("enterApplicantName").setValue("");this.byId("enterApplicantAddress").setValue("");this.byId("enterApplicantMobileNo").setValue("");this.byId("enterEmailId").setValue("");this.byId("enterAadhaarNo").setValue("");this.byId("enterPanNo").setValue("");this.byId("enterSalary").setValue("");this.byId("enterloanamount").setValue("");this.byId("enterloanrepaymentmonths").setValue("");this.byId("selectDocumentType").setSelectedKey(null)},nameValidation:function(e){var t=e.getSource().getValue();var a=e.getSource();var r=/^[a-zA-Z\s]+$/;var s=t.length;if(s==50){a.setValueState(sap.ui.core.ValueState.Error);a.setValueStateText("More Than 50 Characters Not Accepted")}else if(!t.match(r)){a.setValueState(sap.ui.core.ValueState.Error);a.setValueStateText("Only Alphabets can Accepted")}else{a.setValueState(sap.ui.core.ValueState.None)}},numValidation:function(e){var t=e.getSource().getValue();var a=e.getSource();var r=/^[0-9]{10}$/;var s=t.length;if(s!==10){a.setValueState(sap.ui.core.ValueState.Error);a.setValueStateText("Mobile number must be 10 digits")}else if(!t.match(r)){a.setValueState(sap.ui.core.ValueState.Error);a.setValueStateText("Only Numbers can Accepted")}else{a.setValueState(sap.ui.core.ValueState.None)}},emailValidation:function(e){var t=["com","org","net","edu","gov","in","co","io","ai","info","biz","me"];var a=e.getSource().getValue().trim();var r=e.getSource();var s=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;var o=a.split(".");var n=o.length>1?o[o.length-1].toLowerCase():"";if(!s.test(a)||!t.includes(n)){r.setValueState(sap.ui.core.ValueState.Error);r.setValueStateText("Invalid email address")}else{r.setValueState(sap.ui.core.ValueState.None)}},aadhaarValidation:function(e){var t=e.getSource().getValue();var a=e.getSource();var r=/^[0-9]{12}$/;var s=t.length;if(s!==12){a.setValueState(sap.ui.core.ValueState.Error);a.setValueStateText("Aadhaar number must be 12 digits")}else if(!t.match(r)){a.setValueState(sap.ui.core.ValueState.Error);a.setValueStateText("Only Numbers can Accepted")}else{a.setValueState(sap.ui.core.ValueState.None)}},panValidation:function(e){var t=e.getSource().getValue().toUpperCase();e.getSource().setValue(t);var t=e.getSource().getValue();var a=e.getSource();var r=/[A-Z]{5}[0-9]{4}[A-Z]{1}$/;var s=t.length;if(s!==10){a.setValueState(sap.ui.core.ValueState.Error);a.setValueStateText("Pan number must be 10 digits")}else if(!t.match(r)){a.setValueState(sap.ui.core.ValueState.Error);a.setValueStateText("Invalid Pan number")}else{a.setValueState(sap.ui.core.ValueState.None)}},repayValidation:function(e){var t=e.getSource().getValue();var a=e.getSource();var r=/^[0-9]{1,2}$/;var s=t.length;if(s===0||s>2){a.setValueState(sap.ui.core.ValueState.Error);a.setValueStateText("Repayment months allowed upto 2 digits")}else if(!t.match(r)){a.setValueState(sap.ui.core.ValueState.Error);a.setValueStateText("Only Numbers can Accepted")}else{a.setValueState(sap.ui.core.ValueState.None)}},salaryValidation:function(e){var t=e.getSource().getValue();var a=e.getSource();var r=/^[0-9]*$/;var s=t.length;if(s===0){a.setValueState(sap.ui.core.ValueState.Error);a.setValueStateText("Salary cannot be empty")}else if(!t.match(r)){a.setValueState(sap.ui.core.ValueState.Error);a.setValueStateText("Only Numbers can Accepted")}else{a.setValueState(sap.ui.core.ValueState.None)}},loanamountValidation:function(e){var t=e.getSource().getValue();var a=e.getSource();var r=/^[0-9]*$/;var s=t.length;if(s===0){a.setValueState(sap.ui.core.ValueState.Error);a.setValueStateText("Loan Amount cannot be empty")}else if(!t.match(r)){a.setValueState(sap.ui.core.ValueState.Error);a.setValueStateText("Only Numbers can Accepted")}else{a.setValueState(sap.ui.core.ValueState.None)}},onLogout:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("RouteView1");a.show("Logged out!")},onHome:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("dashboard");a.show("Returned Home")}})});
//# sourceMappingURL=loanApplication.controller.js.map